<?xml version="1.0" encoding="utf-8" ?>
<TabbedPage xmlns="http://xamarin.com/schemas/2014/forms"
            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
            x:Class="grade_app.TeacherDisciplinePage"
            xmlns:android="clr-namespace:Xamarin.Forms.PlatformConfiguration.AndroidSpecific;assembly=Xamarin.Forms.Core"
            xmlns:grade_app="clr-namespace:grade_app"
            x:DataType="grade_app:TeacherDisciplinePage"
            android:TabbedPage.ToolbarPlacement="Bottom"
            Title="{Binding TeacherDiscipline.Discipline.SubjectName}">
    <ContentPage Title="Баллы"
                 IconImageSource="{OnPlatform iOS=baseline_assignment_black_24pt, Android=ic_assignment_black_24dp.xml}">
        <StackLayout>
            <Label x:Name="MilestoneLabel"
                   IsVisible="False"
                   FontSize="18"
                   HorizontalTextAlignment="Center"/>
            <Label x:Name="WarningLabel"
                   IsVisible="False"
                   FontSize="18"
                   HorizontalTextAlignment="Center"
                   TextColor="#a94442"
                   BackgroundColor="#f2dede"/>
            <Picker x:Name="SubmodulePicker"
                    Title="Выберите контрольное мероприятие"
                    ItemsSource="{Binding subModulePickerItems}"
                    ItemDisplayBinding="{Binding Name}"
                    SelectedIndexChanged="SubmodulePicker_SelectedIndexChanged"
                    IsVisible="{Binding TeacherDiscipline.Discipline.IsMapCreated}"
                    FontSize="18"/>
            <ListView x:Name="StudentSubmoduleList"
                      ItemsSource="{Binding GroupedStudentItems}"
                      CachingStrategy="RecycleElement"
                      IsGroupingEnabled="True"
                      HasUnevenRows="True"
                      SelectionMode="None"
                      IsVisible="{Binding TeacherDiscipline.Discipline.IsMapCreated}">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="grade_app:StudentSubmoduleItem">
                        <ViewCell>
                            <Grid Padding="10,0"
                                  Margin="5">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="35" />
                                    <ColumnDefinition Width="35" />
                                </Grid.ColumnDefinitions>
                                <Label Grid.Row="0"
                                       Grid.Column="0"
                                       HorizontalTextAlignment="Start"
                                       VerticalTextAlignment="Center"
                                       Text="{Binding Name}"
                                       MaxLines="1"
                                       LineBreakMode="TailTruncation"
                                       FontSize="18"
                                       TextColor="Black"/>
                                <Entry Grid.Row="0"
                                       Grid.Column="1"
                                       Keyboard="Numeric"
                                       ReturnType="Done"
                                       MaxLength="3"
                                       HorizontalTextAlignment="End"
                                       Text="{Binding Rate}"
                                       Focused="Entry_Focused"
                                       Unfocused="Entry_Unfocused"
                                       FontSize="18"
                                       IsEnabled="{Binding Source={RelativeSource AncestorType={x:Type grade_app:TeacherDisciplinePage}}, Path=DisciplineNotFrozen}"/>
                                <Label Grid.Row="0"
                                       Grid.Column="2"
                                       VerticalTextAlignment="Center"
                                       Text="{Binding MaxRate, StringFormat='/{0}'}"
                                       FontSize="18"
                                       TextColor="Black"/>
                            </Grid>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.GroupHeaderTemplate>
                    <DataTemplate x:DataType="grade_app:DisGroup">
                        <ViewCell>
                            <StackLayout VerticalOptions="FillAndExpand"
                                         Padding="0">
                                <Label Text="{Binding Name}" 
                                       HorizontalTextAlignment="Center"
                                       FontSize="19"
                                       TextColor="Black"/>
                            </StackLayout>
                        </ViewCell>
                    </DataTemplate>
                </ListView.GroupHeaderTemplate>
            </ListView>
        </StackLayout>
    </ContentPage>
    <ContentPage Title="Посещения"
                 IconImageSource="{OnPlatform iOS=baseline_date_range_black_24pt, Android=ic_date_range_black_24dp.xml}">
        <StackLayout>
            <Picker x:Name="LessonPicker"
                    Title="Выберите занятие"
                    ItemsSource="{Binding LessonPickerItems}"
                    ItemDisplayBinding="{Binding Name}"
                    SelectedIndexChanged="LessonPicker_SelectedIndexChanged"
                    FontSize="18"/>
            <ListView ItemsSource="{Binding GroupedJournalStudentItems}"
                      IsGroupingEnabled="True"
                      HasUnevenRows="True"
                      SelectionMode="None">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="grade_app:StudentJournalItem">
                        <ViewCell>
                            <Grid Padding="10,0"
                                  Margin="5">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="30" />
                                </Grid.ColumnDefinitions>
                                <Label Grid.Row="0"
                                       Grid.Column="0"
                                       HorizontalTextAlignment="Start"
                                       VerticalTextAlignment="Center"
                                       Text="{Binding Name}"
                                       FontSize="18"
                                       TextColor="Black"
                                       MaxLines="1"
                                       LineBreakMode="TailTruncation"/>
                                <CheckBox Grid.Row="0"
                                       Grid.Column="1"
                                       IsChecked="{Binding Attendance, Mode=OneWay}"
                                       CheckedChanged="CheckBox_CheckedChanged"/>
                            </Grid>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.GroupHeaderTemplate>
                    <DataTemplate x:DataType="grade_app:DisJourGroup">
                        <ViewCell>
                            <StackLayout VerticalOptions="FillAndExpand"
                                         Padding="0">
                                <Label Text="{Binding Name}"
                                       HorizontalTextAlignment="Center"
                                       FontSize="19"
                                       TextColor="Black" />
                            </StackLayout>
                        </ViewCell>
                    </DataTemplate>
                </ListView.GroupHeaderTemplate>
            </ListView>
        </StackLayout>
        <ContentPage.ToolbarItems>
            <ToolbarItem 
                Order="Primary"
                Priority="0"
                IconImageSource="{OnPlatform iOS=baseline_add_circle_white_24pt, Android=baseline_add_circle_24.xml}"
                Clicked="ToolbarItem_Clicked"
                AutomationId="add_lesson"/>
        </ContentPage.ToolbarItems>
    </ContentPage>
    <ContentPage Title="Информация">
        <ScrollView>
            <StackLayout>
                <Label Text="Идентификатор:" FontSize="19" FontAttributes="Bold" />
                <Label Text="{Binding TeacherDiscipline.Discipline.Id}" FontSize="18"/>
                <Label Text="Преподаватели:" FontSize="19" FontAttributes="Bold" />
                <Label Text="{Binding teachersStr}" FontSize="18"/>
            </StackLayout>
        </ScrollView>
    </ContentPage>
</TabbedPage>